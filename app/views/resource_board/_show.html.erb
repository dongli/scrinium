<!-- 如果没有传入current_folder，则必须传入folderable。 -->
<% if not defined? current_folder or not current_folder %>
  <!-- 很抱歉在这里添加增加root文件夹的逻辑，因为在model中无法访问到current_user。 -->
  <% if folderable.folders.empty? %>
    <% folderable.folders.create(
      name: 'root',
      user_id: current_user.id,
      folderable_id: folderable.id,
      folderable_type: folderable.class.to_s
    ) %>
  <% end %>

  <!-- 默认第一个文件夹为当前文件夹。 -->
  <% current_folder = folderable.folders.first %>
<% end %>
<!-- 从cookie中查看是否记录有当前文件夹ID。 -->
<% current_folder_id = cookies[:current_folder_id] %>
<% if current_folder_id and current_folder_id != current_folder.id %>
  <!-- 如果有，则更改当前文件夹。 -->
  <% tmp = Folder.find_by id: current_folder_id %>
  <!-- 为了避免泄露文件，我们必须判断folderable的一致性。 -->
  <% current_folder = tmp if tmp and tmp.folderable == current_folder.folderable %>
<% else %>
  <% cookies[:current_folder_id] = { value: "#{current_folder.id}", path: request.fullpath } %>
<% end %>

<%= render 'resource_board/show_owned', current_folder: current_folder %>
<%= render 'resource_board/show_shares', host: current_folder.folderable %>
